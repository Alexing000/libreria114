<!DOCTYPE html>
<html>
<head>
    <title>Libri Utente</title>
    <link rel="stylesheet" href="/css/libriOrder.css" type="text/css">


</head>
<body>
<div class="wrapper" style="display: grid;
grid-template-rows: auto 1fr auto;
min-height: 100vh;">
    <h1>Libri Utente</h1>
    <style>
    </style>
    <div>
        <a  th:if="${session.loggato=='ok'} " style="color: rgb(97, 139, 18);" href="/homeUtente">Ritorna alla home!</a>
        <a  th:if="${session.loggato!='ok'}"style="color: rgb(97, 139, 18);" href="/home">Ritorna alla home!</a>
        <a th:if="${session.loggato=='ok'}"style="color: rgb(97, 139, 18);" href="/api/libro/libriUtente">Visualizza i tuoi libri!</a>
        <a  style="color: rgb(97, 139, 18);" href="/api/libro/all">Vai nell'archivio libri!</a>
        <a  style="color: rgb(97, 139, 18);" href="/api/autore/all">Vai nell'archivio autori!</a>
   
</div>
    <div id="libri-container">
        <table>
            <thead>
                <TH>COVER</TH>
                <th>TITOLO</th>
                <TH>AUTORE</TH>
                <th>GENERE</th>
                <TH>DATA PUBBLICAZIONE</TH>
                <TH>PAGINE</TH>
                <TH>RATING</TH>
                <th>See More</th>
                <th>Elimina</th>
                
            </thead>
            <tbody>
                <tr th:each="libro:${libri}">
                    <td th:src="${libro.url}"><img th:src="${libro.url}" alt="Copertina"></td>
                    <td th:text="${libro.titolo}"></td>
    
              <!--aggingere collegamento a endpoint /homeUtente-->
    
                
              <td><a  style="color: red;" th:text="${libro.autore}" th:href="@{|/api/autore/byNome?nome=${libro.autore}|}">  </a></td>
         
              <td><a  style="color: red;" th:text="${libro.genere}" th:href="@{|/api/libro/byGenere?genere=${libro.genere}|}">  </a></td>
                    <td th:text="${libro.dataPubblicazione}"></td>
                    <td th:text="${libro.nPagine}"></td>
                    <td th:text="${libro.rating}"></td>
                    <td><a  th:href="|/api/libro/byId?idLibro=${libro.id}|">...</a></td>
                    <td>

                        
               <form action="/api/libro/eliminaDaLista" method="post">
                    <input type="hidden" name="idLibro" th:value="${libro.id}">
                    <input type="hidden" th:value="${count}" name="conto">

                    <button id="deleteButton" class="deleteButton">Elimina!</button>
                </form>
                   
                     
                    </td>
                                            
                </tr>
        
                

            </tbody>
        </table>
            
    </div>
    <div class="footer" style="
    text-align: center;
    margin-top: 40px;
    padding: 10px;
    background-color: grey;
    color: #fff;">
        <footer style="
        left: 0;
        bottom: 0;
        width: 100%;
        text-align: center;">
            <a href="/chiSiamo" id ="chiSiamo">Chi siamo</a>
            <a href="/FAQ" id ="FAQ">FAQ</a>
            <a href="/privacyPolicy" id ="privacyPolicy">Privacy policy</a>
            <a href="/lavoraConNoi" id ="lavoraConNoi">Lavora con noi</a> 
            <!-- Aggiungi link ai social -->
            <a href="https://www.facebook.com/BookWarm" target="_blank" id="facebook">
                <img src="https://cdn.iconscout.com/icon/premium/png-256-thumb/facebook-2752192-2285009.png" alt="Facebook" style="width: 20px; height: 20px; vertical-align: middle;">
                </a>
                <a href="https://www.instagram.com/BookWarm" target="_blank" id="instagram">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/Instagram_icon.png/2048px-Instagram_icon.png" alt="Instagram" style="width: 20px; height: 20px; vertical-align: middle;">
        </footer>
    </div>

</body>
<script >


document.getElementById('deleteButton').addEventListener('click', function() {
    var xhr = new XMLHttpRequest();
    xhr.open("POST", '/api/count', true);
    xhr.setRequestHeader("Content-Type", 'application/json');
    var countValue = document.getElementsByName('conto')[0].value;

    xhr.onload = function() {
        if (xhr.status >= 200 && xhr.status < 300) {
            console.log('Success:', xhr.responseText);
        } else {
            console.log('Error:', xhr.statusText);
        }
    };

    xhr.onerror = function() {
        console.log('Request failed');
    };

    xhr.send(JSON.stringify({
        count: countValue+1
    }));
});
  







</script>
</html>
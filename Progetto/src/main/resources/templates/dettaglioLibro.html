<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/libriOrder.css" type="text/css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  
    <title>DettaglioLibro</title>
</head>
<body onload="adjustInputSizeOnLoad()">
    <!--da aggiungere bottone per arrivare alla pagina-->
    <table>
        <thead>
            <TH>COVER</TH>
            <th>TITOLO</th>
            <th>TRAMA</th>
            <th>PAGINE</th>
           
        </thead>
        <tbody>
            <tr th:each="libro:${libri}">
            <td th:src="${libro.url}"><img th:src="${libro.url}" alt="Copertina"></td>
            <td th:text="${libro.titolo}"></td>
                <td th:text="${libro.trama}"></td>
                <td th:text="${libro.nPagine}"></td>
            </tr>
        
        </tbody>
    </table>
    <h3>Recensioni</h3>
    <table class="table table-striped">
        <tbody>
            <tr th:each="recensione:${recensioni}" th:if="${!#strings.isEmpty(recensione.recensione)}">
                <td th:text="${recensione.username}"></td>
                <td id="recensione">
            
                    <textarea id="myTextarea" class="full-text" th:text="${recensione.recensione}" readonly></textarea>

                </td>
                <div  th:if="${session.username}==${recensione.username} ">
                        <td>
                            <button id="myButton" onclick="modificaRecensione(this)">Modifica recensione</button>
                            <div id="div-button2" style="display: none;">
               
                                <button id="myButton1" 
                                
                                th:recensione="${recensione.recensione}"
                                onclick="modificaRec(this)">Salva la modifica</button>
                                <form id ="from_invio" action="/api/libro/aggiungiRecensione" method="post">
                                    <input type="hidden" name="id" th:value="${idLibro}" >
                                    <input type="hidden" name="recensione"  id="recensioneee" >
                                </form>
                            </div>
                </td>
        
                
            </div>
            
            </tr>
        </tbody>
    </table>
    <div th:if="${avereRec}=='false'">
        <button type="button"  th:libro-id="${idLibro}"
        onclick="aggiungiRec(this)"
        >Aggiungi recensione</button> 
    </div><div id="form-aggiungiRecensione" style="display: none;">
        <form action="/api/libro/aggiungiRecensione" method="post">
           
            <input type="hidden" id="libro-id" name="id">
            <label for="recensione">Recensione</label>
            <input type="text" id="recensione" name="recensione">
            <br>
           <input type="submit" value="Aggiungi">
        </form>


    </div>

    

    <h3><a href="/pagina-libri">Torna alla lista</a></h3>
</body>
<script>
    
    function aggiungiRec(oggetto){
     
     document.getElementById('form-aggiungiRecensione').style.display = 'block';
     var id= document.getElementById("libro-id");
     id.value=oggetto.getAttribute("libro-id");
     console.log('Button clicked');
  
   }
   function modificaRecensione(oggetto) {
    var textarea = document.getElementById('myTextarea');
    textarea.readOnly = false;
    oggetto.style.display = 'none';
    var button = document.getElementById('div-button2');
    button.style.display = 'block';
 
}
function modificaRec(oggetto) {
    var textarea = document.getElementById('myTextarea');
    textarea.readOnly = true;
    oggetto.style.display = 'none';
    var button = document.getElementById('myButton');
    button.style.display = 'block';
    var form = document.getElementById('from_invio');
    var recensioneInput = document.getElementById('recensioneee');
    recensioneInput.value = textarea.value;


    form.submit();

    
}
/*window.onload = function() {
    var textarea = document.querySelector('textarea.full-text');
    var words = textarea.value.split(' ').length;
    if (words < 20) {
        textarea.style.width = '20%';
        textarea.style.height = '50px';
    }
}*/
/*function adjustInputSize(input) {
    var words = input.value.split(' ');
    for (var j = 99; j < words.length; j += 100) {
        words[j] += '\n';
    }
    input.value = words.join(' ');
    var lines = input.value.split('\n');
    var longestLine = lines.reduce(function(a, b) { return a.length > b.length ? a : b; });
    input.rows = lines.length;
    input.cols = longestLine.length;
    input.cols = Math.max(longestLine.length, 50);
}

function adjustInputSizeOnLoad() {
    var inputs = document.querySelectorAll('textarea.full-text');
    for (var i = 0; i < inputs.length; i++) {
        var words = inputs[i].value.split(' ');
        for (var j = 99; j < words.length; j += 100) {
            words[j] += '\n';
        }
        inputs[i].value = words.join(' ');
        var lines = inputs[i].value.split('\n').length;
        inputs[i].rows = lines;
    }
    input.cols = Math.max(longestLine.length, 50);
}*/

 /*  function modificaRecensione(button) {
    var tr = button.closest('tr');
    var recensione = tr.querySelector('span.full-text');
    var newRecensione = prompt('Enter new recensione:');
    if (newRecensione) {
        recensione.textContent = newRecensione;
    }
}*/
    /*window.onload = function() {
        var td = document.getElementById('recensione');
        var shortText = td.getElementsByClassName('short-text')[0];
        var fullText = td.getElementsByClassName('full-text')[0];
        var ellipsis = td.getElementsByClassName('ellipsis')[0];
    
        var words = shortText.innerText.split(' ');
    
        if (words.length > 50) {
            shortText.innerText = words.slice(0, 50).join(' ') + ' ';
        } else {
            ellipsis.style.display = 'none';
        }
    
        ellipsis.onclick = function() {
            shortText.style.display = 'none';
            ellipsis.style.display = 'none';
            fullText.style.display = 'inline';
        }
    
        fullText.onclick = function() {
            shortText.style.display = 'inline';
            ellipsis.style.display = 'inline';
            fullText.style.display = 'none';
        }
    }*/
    </script>
    <style>
        .full-text {

    resize:vertical;
    overflow: auto;
    min-width: 100px; /* adjust as needed */
    max-width: 100%; /* adjust as needed */
}
textarea.full-text {
    width: 100%; /* Or any other value */
}
    </style>
</html>
